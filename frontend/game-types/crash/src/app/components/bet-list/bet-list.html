<div class="bet-tabs-container flex flex-col h-full">
  <!-- Tabs Header -->
  <div class="tabs-header flex border-b border-[#333] w-full">
    <button *ngFor="let tab of tabs; let i = index" (click)="setActiveTab(i)"
      class="flex-1 text-center pt-1 pb-2 font-bold text-[11px] transition-colors focus:outline-none uppercase"
      [class.border-b-2]="activeTab === i" [class.border-orange-500]="activeTab === i"
      [class.text-orange-500]="activeTab === i" [class.text-[#616161]]="activeTab !== i">
      {{ tab | translate }}
    </button>
  </div>

  <!-- Tabs Content -->
  <div class="flex-grow pt-2 overflow-y-auto md:pb-0">
    <ng-container [ngSwitch]="activeTab">

      <!-- Tab 1: Original Bet List --> <!-- BETS -->
      <div *ngSwitchCase="0" class="bet-list-container">
        <div class="flex justify-between items-center bet-list-header font-medium">
          <div class="total-bets flex items-center">
            <img [src]="randomAvatars[0]" class="size-6 rounded-full inline-block border border-[#ccc]"/>
            <img [src]="randomAvatars[1]" class="size-6 rounded-full -ml-2 mr-2 inline-block border border-[#ccc]"/>
            <span class="text-white mr-1">
              {{ Math.max(totalBetCount - ((cashoutStats$ | async)?.cashoutCount ?? 0), 0) }} / {{ totalBetCount }}
            </span>
            <span class="text-[#616161]">{{ 'left-sidebar.bets' | translate  }}</span>
          </div>
          <div class="total-wins">
            <span class="mr-1 text-[#616161]">{{ 'left-sidebar.total-win' | translate  }} </span>
            <span class="text-white">
              {{ getCurrencySym(provider_currency || 'USD') }}{{ ((phase$ | async) === 'BETTING' ? 0 : cashoutStats.cashoutAmount) | number:'1.2-2':'en' }}
            </span>
          </div>
          
        </div>
        <div class="bet-list-body text-xs ">
          <ng-container *ngIf="boomers && boomers.length > 0; else emptyState1">
            <div *ngFor="let boomer of boomers" class="bet-list-row font-medium"
              [class.cashed-out]="boomer.winAmount > 0">
              <span class="row-item username">
                <img [src]="getAvatarPath(boomer.avatar)" class="size-6 border-2 border-gray-700 rounded-full mr-1 inline-block" />
                {{ boomer.username }}
              </span>

              <span class="row-item amount">{{ boomer.amount | number:'1.2-2':'en' }}</span>

              <span class="row-item multiplier py-1.5 bakbak-font mult-font">
                <span
                  [ngClass]="boomer.winAmount > 0 
                  ? ['py-1', 'px-1.5', 'text-[10px]', 'rounded-md', getMultiplierBgColor(boomer.multiplier)] 
                  : ''">
                  {{boomer.winAmount > 0 ? (boomer.multiplier || 1).toFixed(2)+'x' : '-'}}
                </span>
              </span>

              <span class="row-item win-amount">
                {{ boomer.winAmount > 0 ? (getCurrencySym(provider_currency || 'USD') + (boomer.winAmount | number:'1.2-2':'en')) : '-' }}
              </span>
            </div> 
          </ng-container>
        </div>
      </div>

      <!-- Tab 2: Past bets Layout --> <!-- HISTORY -->
      <div *ngSwitchCase="1" class="bet-list-container relative">
          <div class="bet-list-body text-xs py-2 px-2 h-full overflow-y-auto" (scroll)="onScroll($event)">
            <ng-container *ngIf="(mergedHistory$ | async) as hist">
              <ng-container *ngIf="hist.bets && hist.bets.length > 0; else emptyState1">
                <div *ngFor="let historyBetsVal of hist.bets; let i = index" class="history-list-row text-gray-200 rounded-md">
                  <span class="row-item time text-[#8e8e8e] ">

                    {{ player?.username || '-' }}

                    <!-- {{ historyBetsVal.createdAt | date:'d MMM yyyy HH:mm':'UTC' | uppercase }} -->
                  </span>

                  <span class="row-item amount text-white font-semibold">
                        {{ getCurrencySym(provider_currency || 'USD') }}{{ historyBetsVal.amount.bet | number:'1.2-2':'en' }}
                  </span>

                  <span class="row-item multiplier py-1.5 bakbak-font mult-font">
                      <span
                      [ngClass]="historyBetsVal.winAmount > 0 
                      ? ['py-1', 'px-1.5', 'text-[10px]', 'rounded-md', getMultiplierBgColor(historyBetsVal.multiplier)] 
                      : ''">
                      {{historyBetsVal.winAmount > 0 ? (historyBetsVal.multiplier || 1).toFixed(2)+'x' : '-'}}
                    </span>
                  </span>

                  <span class="row-item win-amount text-[var(--text-primary)] font-semibold">
                        {{ getCurrencySym(provider_currency || 'USD') }}{{ historyBetsVal.winAmount | number:'1.2-2':'en' }}
                    <!-- <span class="currency" *ngIf="boomer.winAmount > 0">{{ providerInfo?.currency }}</span> -->
                  </span>
                </div>
              </ng-container>
            </ng-container>   
          </div>
          <!-- <ng-container *ngIf="(phase$ | async) === 'BETTING'">
              <div class="cd py-1.5 px-2 text-[10px] md:text-xs border-t text-[] border-[#333333] rounded-b absolute -bottom-2 w-full text-center">
                {{ 'next-game' | translate }}
                <span class="text-[var(--text-primary)]">
                  {{((countDown$ | async) ?? 0) / 1000 | number:'1.0-0':'en'}} 
                  {{ 'sec' | translate }}
                </span>
              </div>
          </ng-container> -->
      </div>

      <!-- Tab 3: Best bets Layout --> <!-- BEST -->
      <div *ngSwitchCase="2" class="best-tab flex flex-col h-full relative">
        
        <div class="flex items-center justify-between py-1 px-2">
          <button (click)="prevBestTab()" class="p-1 text-gray-300 hover:text-white outline-none border-none focus:outline-none" [disabled]="activeBestTab === 0">
            <img src="assets/icons/arrow-left.png" class="w-2" alt="">
          </button>
          <span class="text-xs font-semibold text-white uppercase">
            {{ bestTabs[activeBestTab] | translate }}
          </span>
          <button (click)="nextBestTab()" class="p-1 text-gray-300 hover:text-white outline-none border-none focus:outline-none"
            [disabled]="activeBestTab === bestTabs.length - 1">
            <img src="assets/icons/arrow-right.png" class="w-2" alt="">
          </button>
        </div>

          <div class="flex-grow overflow-y-auto py-2 px-2" #bestTabScrollContainer>
            <ng-container [ngSwitch]="activeBestTab">

              <ng-container *ngSwitchCase="0">
                <ng-container *ngIf="subtabs_best_cashed && subtabs_best_cashed.length > 0; else emptyState1">     
                  <div class="flex border-2 border-[#333333] rounded-md overflow-hidden mb-2">
                    <span
                      *ngFor="let period of bestPeriods; let i = index"
                      (click)="setBestCashedPeriod(period.value)"
                      class="btn flex-1 py-1.5 text-xs font-[500] transition-colors text-center cursor-pointer"
                      [ngClass]="{
                        'bg-[#343434]': selectedBestCashedPeriod === period.value,
                        'bg-[#1f1f1f] hover:bg-[#333]': selectedBestCashedPeriod !== period.value
                      }"
                    >
                      {{ period.key | translate }}
                    </span>
                  </div>

                  <div *ngFor="let result of subtabs_best_cashed"
                    class="bg-[#232323] mb-2 rounded-tl-2xl rounded-br-2xl"
                  >
                    <div class="flex items-center justify-between py-2 px-2">
                      <span
                        class="px-2 min-w-20 text-center py-1 bakbak-font mult-font text-white text-sm rounded-md"
                        [ngClass]="getMultiplierBgColor(result.multiplier || 1.00)"
                      >
                        {{ result.multiplier }}x
                      </span>

                      <div class="text-xs flex">
                        <div class="text-right mr-2 text-[#fefefe]">
                          <p class="mb-1">{{ 'left-sidebar.best_tab.bet' | translate  }}</p> 
                          <p>{{ 'left-sidebar.best_tab.win' | translate  }}</p> 
                        </div>
                        <div class="font-semibold">
                          <p class="text-white mb-1">
                        {{ getCurrencySym(provider_currency || 'USD') }}{{ result.amount | number:'1.2-2':'en' }}
                          </p>
                          <p class="text-orange-500">
                        {{ getCurrencySym(provider_currency || 'USD') }}{{ result.winAmount | number:'1.2-2':'en' }}
                          </p>
                        </div>
                      </div>
                    </div>
                    
                    <!-- Footer Info -->
                    <div class="flex justify-between items-center text-[10px] bg-[#2a2a2a] text-[#818181] py-1 px-3 rounded-tl-2xl rounded-br-2xl">
                      <div>
                        <h6>{{ result.date | date:'d MMM yyyy':'UTC' | uppercase }}</h6>
                        <h6>
                          {{ result.username }}
                        </h6>
                      </div>
                      <div>
                        <h6>
                          {{ 'left-sidebar.best_tab.round' | translate  }}: 
                          <strong>{{ result.multiplier|number: '1.2-2':'en' }}x</strong>
                        </h6>
                      </div>
                    </div>
                  </div>

                </ng-container>
              </ng-container>

              <ng-container *ngSwitchCase="1">
                <ng-container *ngIf="subtabs_best_wins && subtabs_best_wins.length > 0; else emptyState1">     
                  <div class="flex border-2 border-[#333333] rounded-md overflow-hidden mb-2">
                    <span
                      *ngFor="let period of bestPeriods; let i = index"
                      (click)="setBestWinsPeriod(period.value)"
                      class="btn flex-1 py-1.5 text-xs font-[500] transition-colors text-center cursor-pointer"
                      [ngClass]="{
                        'bg-[#343434]': selectedBestWinsPeriod === period.value,
                        'bg-[#1f1f1f] hover:bg-[#333]': selectedBestWinsPeriod !== period.value
                      }"
                    >
                      {{ period.key | translate }}
                    </span>
                  </div>

                  <div *ngFor="let result of subtabs_best_wins"
                    class="bg-[#232323] mb-2 rounded-tl-2xl rounded-br-2xl"
                  >
                    <div class="flex items-center justify-between py-2 px-2">
                      <div class="text-xs flex">
                        <div class="text-right mr-2 text-[#fefefe]">
                          <p class="mb-1">{{ 'left-sidebar.best_tab.bet' | translate  }}</p> 
                          <p>{{ 'left-sidebar.best_tab.win' | translate  }}</p> 
                        </div>
                        <div class="font-semibold">
                          <p class="text-white mb-1">
                        {{ getCurrencySym(provider_currency || 'USD') }}{{ result.amount | number:'1.2-2':'en' }}
                          </p>
                          <p class="text-orange-500">
                        {{ getCurrencySym(provider_currency || 'USD') }}{{ result.winAmount | number:'1.2-2':'en' }}
                            </p>
                        </div>
                      </div>
                      
                      <span
                        class="px-2 min-w-20 text-center py-1 bakbak-font mult-font text-sm rounded-md"
                        [ngClass]="getMultiplierBgColor(result.multiplier)"
                      >
                        {{ result.multiplier }}x
                      </span>

                      
                    </div>
                    
                    <!-- Footer Info -->
                    <div class="flex justify-between items-center text-[10px] bg-[#2a2a2a] text-gray-400 py-1 px-3 rounded-br-2xl">
                      <div>
                        <h6>
                          {{ result.date | date:'d MMM yyyy':'UTC' | uppercase }}
                        </h6>
                        <h6>
                          {{ result.username }}
                        </h6>
                      </div>
                      <div>
                        <h6>
                          {{ 'left-sidebar.best_tab.round' | translate  }}: 
                          <strong>{{ result.roundMultiplier.toFixed(2) }}x</strong>
                        </h6>
                      </div>
                    </div>
                  </div>

                </ng-container>
              </ng-container>

              <ng-container *ngSwitchCase="2">
                <ng-container *ngIf="subtabs_best_result && subtabs_best_result.length > 0; else emptyState1">     
                  <div class="flex border-2 border-[#333333] rounded-md overflow-hidden mb-2">
                    <span
                      *ngFor="let period of bestPeriods; let i = index"
                      (click)="setBestResultsPeriod(period.value)"
                      class="btn flex-1 py-1.5 text-xs font-[500] transition-colors text-center cursor-pointer"
                      [ngClass]="{
                        'bg-[#343434]': selectedBestResultsPeriod === period.value,
                        'bg-[#1f1f1f] hover:bg-[#333]': selectedBestResultsPeriod !== period.value
                      }"
                    >
                      {{ period.key | translate }}
                    </span>
                  </div>        
                  <div class="">
                    <!-- ANKUR ASK
                    <div class="text-center best-results-top">
                      <span
                          class="px-4 min-w-20 text-center pb-1.5 pt-1 font-bold text-white text-xs rounded-md"
                          [ngClass]="getMultiplierBgColor(5)"
                        >
                          5x
                        </span>
                        <p class="text-[10px] mt-1.5 font-semibold text-[var(--text-secondary)]">
                          20/08/2025 03:42:30 GMT
                        </p>
                    </div>
                    -->
                    <div class="rounded best-results-list mt-3">
                      <div *ngFor="let result of subtabs_best_result" class="bg-[#2a2a2a] mb-1 flex items-center justify-between p-1.5 pl-2 rounded">
                          <p class="text-[10px] text-[#8e8e8e] font-semibold text-ellipsis overflow-hidden whitespace-nowrap text-nowrap">
                            {{ result.date | date:'d MMM yyyy HH:mm:ss \'GMT\'' }}
                          </p>
                        <p class="px-2 min-w-20 text-center pb-1.5 pt-1 bakbak-font mult-font text-xs rounded-md"
                            [ngClass]="getMultiplierBgColor(result.multiplier)">
                            {{result.multiplier}}x
                        </p>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </ng-container>
            </ng-container>
          </div>
          
          <!-- <ng-container *ngIf="(phase$ | async) === 'BETTING'">
              <div class="cd py-1.5 px-2 text-[10px] md:text-xs border-t text-[] border-[#333333] rounded-b absolute -bottom-2 w-full text-center">
                {{ 'next-game' | translate }}
                <span class="text-[var(--text-primary)]">
                  {{((countDown$ | async) ?? 0) / 1000 | number:'1.0-0':'en'}} 
                  {{ 'sec' | translate }}
                </span>
              </div>
          </ng-container> -->
      </div>

      <!-- Tab 4: Stats Layout --> <!-- STATS -->
      <div *ngSwitchCase="3" class="stats-tab flex flex-col h-full relative">

        <!-- LAST RESULTS header -->
        <div class="flex items-center justify-between py-1 px-2">
          <button (click)="prevStatsTab()" class="p-1 text-[#fefefe] hover:text-white outline-none border-none focus:outline-none" [disabled]="activeStatsTab === 0">
            <img src="assets/icons/arrow-left.png" class="w-2" alt="">
          </button>
          <span class="text-xs font-semibold text-[#fefefe] uppercase">
            {{ statsTabs[activeStatsTab] | translate }}
          </span>
          <button (click)="nextStatsTab()" class="p-1 text-[#fefefe] hover:text-white outline-none border-none focus:outline-none"
            [disabled]="activeStatsTab === statsTabs.length - 1">
            <img src="assets/icons/arrow-right.png" class="w-2" alt="">
          </button>
        </div>

        <!-- Results list -->
        <div class="flex-grow overflow-y-auto py-2 px-2">
          <ng-container [ngSwitch]="activeStatsTab">
            <!-- Last Results -->
            <ng-container *ngSwitchCase="0">
              <ng-container *ngIf="subtabs_stats_last_history && subtabs_stats_last_history.length > 0; else emptyState1">
                <div class="grid grid-cols-3 gap-2">
                  <div *ngFor="let round of subtabs_stats_last_history"
                    class="px-2 py-2 rounded bakbak-font mult-font text-xs text-center cursor-pointer"
                    [ngClass]="getMultiplierBgColor(round.crash)">
                    {{ round.crash.toFixed(2) }}x
                  </div>
                </div>
              </ng-container>
            </ng-container>

            <!-- Charts -->
            <ng-container *ngSwitchCase="1">
              <div class="charts-list mt-2 px-1.5">
                <ng-container *ngIf="subtabs_stats_stats_info && subtabs_stats_stats_info.length > 0; else emptyState1">
                    <div *ngFor="let chart of subtabs_stats_stats_info" class="chart-list-item mb-6">
                      <div class="multiplier-info mb-2 flex justify-between items-center">
                        <p class="font-[500] text-xs text-white">{{chart.range}}</p>
                        <p class="font-[700] text-[var(--text-primary)] text-xs"> {{chart.percent}}% </p>
                      </div>

                      <div class="h-[4px] w-full relative bg-black chart-list-progress rounded-full">
                        <span class="absolute rounded-full top-0 left-0 bottom-0 bg-[var(--text-primary)]" [style.width.%]="(chart.percent)"></span>
                      </div>

                    </div>
                </ng-container>
              </div>
            </ng-container>

          
          </ng-container>
        </div>

        <!-- <ng-container *ngIf="(phase$ | async) === 'BETTING'">
              <div class="cd py-1.5 px-2 text-[10px] md:text-xs border-t text-[] border-[#333333] rounded-b absolute -bottom-2 w-full text-center">
                {{ 'next-game' | translate }}
                <span class="text-[var(--text-primary)]">
                  {{((countDown$ | async) ?? 0) / 1000 | number:'1.0-0':'en'}} 
                  {{ 'sec' | translate }}
                </span>
              </div>
          </ng-container> -->
      </div>

    </ng-container>
  </div>
  <ng-template #emptyState1>
    <!-- <div class="empty-state text-xs font-bold">{{ 'left-sidebar.no-data' | translate  }}</div> -->
  </ng-template>
</div>